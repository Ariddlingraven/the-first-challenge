<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>A Midnight Riddle</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Playfair+Display:ital,wght@0,400;0,700;1,400&display=swap" rel="stylesheet">
    <style>
        /* * WIDGET STYLES
         * A visually stunning, mobile-first poetry experience inspired by Didot typography.
        */
        :root {
            --background-color: #EDE6E0; /* Updated background color */
            --text-color: #111;
            --highlight-color: #9F1617; /* New color for specific words */
        }

        html {
            scroll-behavior: smooth;
        }

        body {
            font-family: 'Playfair Display', serif;
            background-color: var(--background-color);
            color: var(--text-color);
            margin: 0;
            padding: 0;
            transition: background-color 1s ease;
        }

        #riddle-container {
            max-width: 800px;
            width: 90%;
            margin: 0;
            padding: 5vw;
            text-align: left;
        }

        #riddle-text {
            font-size: clamp(1.6rem, 4.5vw, 2.8rem);
            font-weight: 400;
            font-style: italic; /* Italicized poem */
            line-height: 1.6;
            letter-spacing: 0.05em;
            margin: 0;
            padding: 0;
            white-space: pre-wrap;
            text-wrap: pretty;
        }

        #riddle-text .line {
            display: block;
            opacity: 0; /* Lines are completely invisible by default */
            transform: translateY(20px);
            transition: opacity 1s ease, transform 1s ease;
        }

        #riddle-text .line.visible {
            opacity: 1; /* Fully visible when in focus */
            transform: translateY(0);
        }

        #riddle-text .line.empty {
            height: 1em; /* Creates the space between stanzas */
        }
        
        #riddle-text .highlight {
            color: var(--highlight-color);
            font-weight: 700;
        }
        
        #riddle-form {
            display: none;
            flex-direction: column;
            align-items: flex-start;
            margin-top: 3rem;
            opacity: 0;
            transition: opacity 1s ease 1s;
        }

        #riddle-form.visible {
            display: flex;
            opacity: 1;
        }

        #riddle-form input[type="text"] {
            background: transparent;
            border: none;
            border-bottom: 2px solid rgba(0,0,0,0.2);
            font-size: clamp(1.5rem, 4vw, 2.5rem);
            font-family: 'Playfair Display', serif;
            font-style: italic;
            color: var(--text-color);
            text-align: left;
            width: 100%;
            max-width: 500px;
            padding: 10px 0;
            transition: border-color 0.3s ease;
        }
        
        #riddle-form input[type="text"]::placeholder {
            color: rgba(0,0,0,0.3);
            opacity: 1;
        }

        #riddle-form input[type="text"]:focus {
            outline: none;
            border-color: var(--text-color);
        }

        #submit-icon {
            background: transparent;
            border: none;
            cursor: pointer;
            margin-top: 2rem;
            padding: 10px;
            transition: transform 0.3s ease;
        }
        
        #submit-icon:hover {
            transform: scale(1.15);
        }

        #submit-icon svg {
            width: 50px; 
            height: 50px;
            fill: var(--highlight-color);
        }


        #feedback-message {
            margin-top: 2rem;
            font-size: 1.5rem;
            font-style: italic;
            min-height: 2em;
        }
        
        /* Typing cursor effect for feedback */
        .typing-effect::after {
            content: '|';
            display: inline-block;
            animation: blink 0.7s infinite;
        }

        @keyframes blink {
            0%, 100% { opacity: 1; }
            50% { opacity: 0; }
        }

        .correct { color: #006400; }
        .incorrect { color: #8B0000; }
    </style>
</head>
<body>

    <div id="riddle-container">
        <p id="riddle-text"></p>
        <form id="riddle-form" onsubmit="checkAnswer(event)">
            <input type="text" id="riddle-answer" required autocomplete="off" placeholder="Say my name.">
            <button type="button" id="submit-icon" aria-label="Submit Answer">
                <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><circle cx="12" cy="12" r="2"/><circle cx="19" cy="12" r="2"/><circle cx="5" cy="12" r="2"/></svg>
            </button>
            <div id="feedback-message"></div>
        </form>
    </div>

    <script>
        document.addEventListener('DOMContentLoaded', () => {
            const riddleElement = document.getElementById('riddle-text');
            const riddleForm = document.getElementById('riddle-form');
            const answerInput = document.getElementById('riddle-answer');
            const submitButton = document.getElementById('submit-icon');
            
            const fullPoem = `From the silence, darkly spoken,
Threads of riddles left unbroken,
Every word a cryptic token,
From the night’s plutonian shore.

Comes a fowl vis’tor tapping,
On your thoughts its talons rapping,
Challenger to your mind mapping
Name this bird of myth, and lore.
Till you answer nothing more.

“Tell me, dreamer, tell me, guesser,
Dare you name this dark confessor?
Mark the sound of your addressor
Bound in poems evermore.

Sit you now, engage in guessing,
Not one more syllable expressed in—
Name in repetend is dressed in
Say the name I hunger for?
My name is not, nevermore.`;
            
            const lines = fullPoem.split('\n');
            const highlightWords = ['cryptic', 'lore', 'dreamer', 'poems', 'nevermore'];

            lines.forEach((lineText, lineIndex) => {
                const lineSpan = document.createElement('span');
                lineSpan.className = 'line';

                if (lineText.trim() === '') {
                    lineSpan.classList.add('empty');
                } else if (lineIndex === 0) {
                    const highlightText = "From the silence,";
                    const restOfLine = " darkly spoken,";
                    
                    const highlightSpan = document.createElement('span');
                    highlightSpan.className = 'highlight';
                    highlightSpan.textContent = highlightText;
                    
                    lineSpan.appendChild(highlightSpan);
                    lineSpan.append(document.createTextNode(restOfLine));
                } else {
                    const words = lineText.split(/(\s+)/);
                    words.forEach(word => {
                        const cleanedWord = word.trim().replace(/[.,?]/g, '').toLowerCase();
                        if (highlightWords.includes(cleanedWord)) {
                            const highlightSpan = document.createElement('span');
                            highlightSpan.className = 'highlight';
                            highlightSpan.textContent = word;
                            lineSpan.appendChild(highlightSpan);
                        } else {
                            lineSpan.append(document.createTextNode(word));
                        }
                    });
                }
                riddleElement.appendChild(lineSpan);
            });
            
            const lineSpans = riddleElement.querySelectorAll('.line');
            let currentLine = 0;

            // Initially reveal only the first line
            if (lineSpans[currentLine]) {
                lineSpans[currentLine].classList.add('visible');
            }

            const revealNextLine = () => {
                currentLine++;
                
                if (lineSpans[currentLine] && lineSpans[currentLine].classList.contains('empty')) {
                    lineSpans[currentLine].classList.add('visible');
                    currentLine++;
                }

                if (lineSpans[currentLine]) {
                    lineSpans[currentLine].classList.add('visible');
                }
                
                if (currentLine >= lineSpans.length - 1) {
                    setTimeout(() => {
                        riddleForm.classList.add('visible');
                        answerInput.focus();
                        window.removeEventListener('click', revealNextLine);
                    }, 1000);
                }
            };

            window.addEventListener('click', revealNextLine);

            submitButton.addEventListener('click', () => {
                riddleForm.requestSubmit();
            });
        });

        function typeSequence(element, sequence, onComplete) {
            let sequenceIndex = 0;
            element.innerHTML = '';

            function processAction() {
                if (sequenceIndex >= sequence.length) {
                    if (onComplete) onComplete();
                    return;
                }
                const action = sequence[sequenceIndex];
                if (action.type === 'text') {
                    let charIndex = 0;
                    const text = action.value;
                    const speed = action.speed || 50;
                    element.classList.add('typing-effect');
                    function typeChar() {
                        if (charIndex < text.length) {
                            element.innerHTML += text.charAt(charIndex);
                            charIndex++;
                            setTimeout(typeChar, speed);
                        } else {
                            element.classList.remove('typing-effect');
                            sequenceIndex++;
                            processAction();
                        }
                    }
                    typeChar();
                } else if (action.type === 'pause') {
                    setTimeout(() => {
                        sequenceIndex++;
                        processAction();
                    }, action.duration);
                }
            }
            processAction();
        }

        function checkAnswer(event) {
            event.preventDefault();

            const correctAnswer = "Quothe";
            const redirectURL = "https://en.wikipedia.org/wiki/The_Raven";

            const userAnswer = document.getElementById('riddle-answer').value;
            const feedback = document.getElementById('feedback-message');
            
            if (userAnswer.trim().toLowerCase() === correctAnswer.toLowerCase()) {
                feedback.className = "correct";
                
                const successSequence = [
                    { type: 'text', value: 'The devil told you that...', speed: 60 },
                    { type: 'pause', duration: 800 },
                    { type: 'text', value: ' very well,', speed: 80 },
                    { type: 'pause', duration: 600 },
                    { type: 'text', value: ' one moment.', speed: 60 }
                ];

                typeSequence(feedback, successSequence, () => {
                    setTimeout(() => {
                        window.location.href = redirectURL;
                    }, 500);
                });

            } else {
                feedback.className = "incorrect";
                const incorrectText = "A good riddle is sometimes a puzzle in words, other times a magician's trick. That's incorrect. Would you try me again?";
                const boldPart = "That's incorrect. Would you try me again?";
                
                const incorrectSequence = [{ type: 'text', value: incorrectText, speed: 45 }];

                typeSequence(feedback, incorrectSequence, () => {
                    const newHTML = feedback.innerHTML.replace(boldPart, `<b>${boldPart}</b>`);
                    feedback.innerHTML = newHTML;
                    document.getElementById('riddle-answer').value = '';
                });
            }
        }
    </script>

</body>
</html>
